inherichance_heirs_story = { 

	on_setup = {
		set_variable = {
			name = story_owner
			value = story_owner
		}
		story_owner = {
			set_variable = {
				name = primary_heir
				value = THIS
			}
			if = {
				limit = { has_game_rule = inherichance_random }
				random_player_heir = {
					scope:story = {
						set_variable = {
							name = random_heir
							value = PREV
						}
					}
				}
			}
			else_if = {
				limit = { has_game_rule = inherichance_underdog }
				ordered_player_heir = {
					order_by = {
						every_heir_to_title = {
							limit = {
								holder = scope:story.story_owner.var:dead_character
								is_leased_out = no
								tier = tier_barony
							}
							subtract = 1
						}
						every_held_title = {
							limit = {
								is_leased_out = no
								tier = tier_barony
								previous_holder = scope:story.story_owner.var:dead_character
							}
							subtract = 1
						}
					}
					scope:story = {
						set_variable = {
							name = random_heir
							value = PREV
						}
					}
				}
			}
			else_if = {
				limit = { has_game_rule = inherichance_topdog }
				ordered_player_heir = {
					order_by = {
						every_heir_to_title = {
							limit = {
								holder = scope:story.story_owner.var:dead_character
								is_leased_out = no
							}
							add = 1
						}
						every_held_title = {
							limit = {
								is_leased_out = no
								tier = tier_barony
								previous_holder = scope:story.story_owner.var:dead_character
							}
							add = 1
						}
					}
					scope:story = {
						set_variable = {
							name = random_heir
							value = PREV
						}
					}
				}
			}
			every_player_heir = {
				limit = { NOT = { THIS = scope:story.var:random_heir }}
				scope:story = {
					add_to_variable_list = {
						name = other_heirs
						target = PREV
					}
				}
			}

			every_player_heir = {
				set_variable = {
					name = dead_character
					value = scope:story.story_owner
				}
				set_variable = {
					name = inherichance_heirs_story
					value = scope:story
				}
				create_story = {
					type = inherichance_titles_story
					save_temporary_scope_as = inherichance_titles_story
				}
				if = {
					limit = { NOT = { THIS = scope:story.var:random_heir }}
					scope:story = {
						add_to_variable_list = {
							name = other_heirs
							target = PREV
						}
						add_to_variable_list = {
							name = inherichance_titles_stories
							target = scope:inherichance_titles_story
						}
					}
					scope:inherichance_titles_story = {
						every_in_list = {
							variable = inherited_titles
							scope:story = {
								add_to_variable_list = {
									name = inherichance_lost_titles
									target = PREV
								}
							}
						}
					}
				}
			}
		}
		set_variable = {
			name = inherichance_lost_titles_number
			value = {
				every_in_list = {
					variable = inherichance_lost_titles
					add = 1
				}
			}
		}
		make_story_owner = var:random_heir
	}

	on_end = {
		every_in_list = {
			variable = inherichance_titles_stories
			end_story = yes
		}
	}

	on_owner_death = {
		
	}
}

inherichance_titles_story = {
	on_setup = {
		set_variable = {
			name = heir
			value = story_owner
		}
		story_owner = {
			set_variable = {
				name = inherichance_titles_story
				value = scope:story
			}
			ordered_heir_to_title = {
				limit = {
					holder = scope:story.story_owner.var:dead_character
					is_leased_out = no
				}
				order_by = tier
				min = 0
				scope:story = {
					add_to_variable_list = {
						name = inherited_titles
						target = PREV
					}
				}
			}
		}
	}

	on_end = {
		story_owner = {
			if = { limit = { has_variable = inherichance_heirs_story } remove_variable = inherichance_heirs_story }
			if = { limit = { has_variable = dead_character } remove_variable = dead_character }
		}
	}
}