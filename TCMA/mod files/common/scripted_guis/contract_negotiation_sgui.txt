testing = {
	scope = character

	effect = {
		add_gold = 1000
	}
}

initiate_contract_negotiation = {
	scope = character
	
	is_shown = {
		
	}
	
	is_valid = {
		
	}

	effect = {
		if = {
			limit = { NOT = { has_variable = contract_negotiation }}
			add_character_flag = gui_contract_negotiation
			if = {
				limit = { scope:recipient = THIS.liege }
				start_feudal_contract_negotiation = { VASSAL = THIS INITIATOR = THIS }
			}
			else = {
				start_feudal_contract_negotiation = { VASSAL = scope:recipient INITIATOR = THIS }
			}
		}
	}
}

end_contract_negotiation = {
	scope = character
	
	is_shown = {
		
	}
	
	is_valid = {
		
	}

	effect = {
		if = {
			limit = { has_character_flag = gui_contract_negotiation }
			remove_character_flag = gui_contract_negotiation
			var:contract_negotiation = { end_story = yes }
		}
	}
}

update_contract_acceptance = {
	scope = character
	effect = {
		var:contract_negotiation = {
			if = {
				limit = {
					has_variable_list = negotiated_obligations
					any_in_list = {
						variable = negotiated_obligations
						var:obligation = scope:obligation
					}
				}
				every_in_list = {
					variable = negotiated_obligations
					limit = { var:obligation = scope:obligation }
					PREV = {
						remove_list_variable = {
							name = negotiated_obligations
							target = PREV
						}
					}
				}
			}
		}
		every_owned_story = {
			limit = {
				story_type = obligation_level_desire
				var:obligation = scope:obligation
				var:level = scope:level
			}
			PREV.var:contract_negotiation = {
				add_to_variable_list = {
					name = negotiated_obligations
					target = PREV
				}
			}
		}
	}
}


