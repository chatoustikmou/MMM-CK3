initiate_contract_negotiation_with_liege = {
	scope = character
	
	is_shown = {
		
	}
	
	is_valid = {
		
	}

	effect = {
		start_feudal_contract_negotiation = { VASSAL = THIS INITIATOR = this }
		add_gold = 1000
	}
}

end_contract_negotiation = {
	scope = character
	
	is_shown = {
		
	}
	
	is_valid = {
		
	}

	effect = {
		start_feudal_contract_negotiation = { VASSAL = THIS INITIATOR = THIS }
		add_gold = 1000
		trigger_event = {
			on_action = clean_up_negotiation
			days = 1
		}
	}
}

update_contract_acceptance = {
	scope = character
	effect = {
		add_gold = 1000
		var:contract_negotiation = {
			if = {
				limit = {
					has_variable_list = negotiated_obligations
					any_in_list = {
						variable = negotiated_obligations
						var:obligation = scope:obligation
					}
				}
				every_in_list = {
					variable = negotiated_obligations
					limit = { var:obligation = scope:obligation }
					PREV = {
						remove_list_variable = {
							name = negotiated_obligations
							target = PREV
						}
					}
				}
			}
		}
		every_owned_story = {
			limit = {
				story_type = obligation_level_desire
				var:obligation = scope:obligation
				var:level = scope:level
			}
			PREV.var:contract_negotiation = {
				add_to_variable_list = {
					name = negotiated_obligations
					target = PREV
				}
			}
		}
		var:contract_negotiation = {
			set_variable = {
				name = contract_acceptance
				value = 0
			}
			if = {
				limit = { var:vassal = PREV }
				every_in_list = {
					variable = negotiated_obligations
					PREV = {
						change_variable = {
							name = contract_acceptance
							add = PREV.var:ruler_desire
							subtract = PREV.var:ruler_refusal
						}
					}
				}
			}
			else_if = {
				limit = { var:ruler = PREV }
				every_in_list = {
					variable = negotiated_obligations
					PREV = {
						change_variable = {
							name = contract_acceptance
							add = PREV.var:vassal_desire
							subtract = PREV.var:vassal_refusal
						}
					}
				}
			}
		}
	}
}


